<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:Intune.Commander.Desktop.ViewModels"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             xmlns:mi="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:icons="clr-namespace:Material.Icons;assembly=Material.Icons"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="900"
             x:Class="Intune.Commander.Desktop.Views.OverviewView"
             x:DataType="vm:OverviewViewModel">

    <Panel>
    <!-- Loading overlay -->
    <suki:BusyArea BusyText="Loading dashboard data..."
                   IsBusy="{Binding IsLoading}"
                   IsVisible="{Binding IsLoading}"
                   ZIndex="10" />

    <!-- Dashboard content -->
    <ScrollViewer HorizontalScrollBarVisibility="Disabled" IsVisible="{Binding !IsLoading}">
        <StackPanel Margin="16" Spacing="16">

            <!-- ═══════════════════════════════════════════ -->
            <!-- Welcome Banner                             -->
            <!-- ═══════════════════════════════════════════ -->
            <StackPanel Spacing="4" Margin="0,4,0,4">
                <TextBlock FontSize="{StaticResource FontSizeDisplay}" FontWeight="Bold">
                    <Run Text="Welcome, " />
                    <Run Text="{Binding TenantName}" Foreground="{DynamicResource SystemControlForegroundAccentBrush}" />
                </TextBlock>
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <TextBlock FontSize="{StaticResource FontSizeBody}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                        <Run Text="Tenant ID:" />
                        <Run Text="{Binding TenantId}" />
                    </TextBlock>
                    <TextBlock FontSize="{StaticResource FontSizeBody}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                        <Run Text="Cloud:" />
                        <Run Text="{Binding CloudEnvironment}" />
                    </TextBlock>
                </StackPanel>
            </StackPanel>

            <!-- ═══════════════════════════════════════════════════════ -->
            <!-- Quick Stats: all 8 in one compact container           -->
            <!-- ═══════════════════════════════════════════════════════ -->
            <suki:GlassCard Padding="10,8">
                <StackPanel Spacing="0">
                    <!-- Row 1: Policies/Configs -->
                    <UniformGrid Rows="1" Columns="4">
                        <Button Command="{Binding NavigateToDeviceConfigsCommand}"
                                Padding="0" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Device Configurations">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalDeviceConfigs}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardBlueBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardBlueBrush}" /><Run Text="DEVICE CONFIGS" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToCompliancePoliciesCommand}"
                                Padding="0" Margin="4,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Compliance Policies">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalCompliancePolicies}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardGreenBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardGreenBrush}" /><Run Text="COMPLIANCE" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToApplicationsCommand}"
                                Padding="0" Margin="4,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Applications">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalApplications}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardOrangeBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardOrangeBrush}" /><Run Text="APPLICATIONS" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToSettingsCatalogCommand}"
                                Padding="0" Margin="4,0,0,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Settings Catalog Policies">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalSettingsCatalog}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardPurpleBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardPurpleBrush}" /><Run Text="SETTINGS CATALOG" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                    </UniformGrid>

                    <Separator Margin="4,4" Opacity="0.25" />

                    <!-- Row 2: Security/Access/Scripts -->
                    <UniformGrid Rows="1" Columns="4">
                        <Button Command="{Binding NavigateToEndpointSecurityCommand}"
                                Padding="0" Margin="0,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Endpoint Security Policies">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalEndpointSecurity}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardCyanBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardCyanBrush}" /><Run Text="ENDPOINT SECURITY" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToConditionalAccessCommand}"
                                Padding="0" Margin="4,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Conditional Access Policies">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalConditionalAccess}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardPinkBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardPinkBrush}" /><Run Text="CONDITIONAL ACCESS" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToScriptsCommand}"
                                Padding="0" Margin="4,0,4,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Device Scripts">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding TotalScripts}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardTealBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardTealBrush}" /><Run Text="SCRIPTS" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                        <Button Command="{Binding NavigateToUnassignedAppsCommand}"
                                Padding="0" Margin="4,0,0,0"
                                Background="Transparent" BorderThickness="0"
                                Cursor="Hand" HorizontalAlignment="Stretch"
                                ToolTip.Tip="View Unassigned Applications">
                            <StackPanel Spacing="1" Margin="8,6">
                                <TextBlock Text="{Binding UnassignedAppCount}" FontSize="20" FontWeight="Bold"
                                           Foreground="{DynamicResource StatCardRedBrush}" />
                                <TextBlock FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}">
                                    <Run Text="● " Foreground="{DynamicResource StatCardRedBrush}" /><Run Text="UNASSIGNED APPS" />
                                </TextBlock>
                            </StackPanel>
                        </Button>
                    </UniformGrid>
                </StackPanel>
            </suki:GlassCard>

            <!-- ═══════════════════════════════════════════ -->
            <!-- Charts Row: Pie charts side by side        -->
            <!-- ═══════════════════════════════════════════ -->
            <Grid ColumnDefinitions="*,16,*">
                <!-- Apps by Platform -->
                <suki:GlassCard Padding="12">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Applications by Platform"
                                   FontSize="{StaticResource FontSizeSubheading}" FontWeight="SemiBold" Margin="0,0,0,4" />
                        <lvc:PieChart Series="{Binding AppsByPlatformSeries}"
                                      LegendPosition="Bottom"
                                      Height="220" />
                    </DockPanel>
                </suki:GlassCard>

                <!-- Configs by Platform -->
                <suki:GlassCard Grid.Column="2" Padding="12">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Configurations by Platform"
                                   FontSize="{StaticResource FontSizeSubheading}" FontWeight="SemiBold" Margin="0,0,0,4" />
                        <lvc:PieChart Series="{Binding ConfigsByPlatformSeries}"
                                      LegendPosition="Bottom"
                                      Height="220" />
                    </DockPanel>
                </suki:GlassCard>
            </Grid>

            <!-- ═══════════════════════════════════════════════════════════ -->
            <!-- Recently Modified: Policies | Apps side by side           -->
            <!-- ═══════════════════════════════════════════════════════════ -->
            <Grid ColumnDefinitions="*,16,*">
                <!-- Left: Policies (Device Configs + Compliance) -->
                <suki:GlassCard Padding="12">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Recently Modified Policies"
                                   FontSize="{StaticResource FontSizeSubheading}" FontWeight="SemiBold" Margin="0,0,0,8" />
                        <ItemsControl ItemsSource="{Binding RecentlyModifiedPolicies}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:RecentItem">
                                    <Border Padding="8,5" Margin="0,0,0,2" CornerRadius="{StaticResource RadiusSmall}">
                                        <DockPanel>
                                            <TextBlock DockPanel.Dock="Right" Text="{Binding ModifiedText}"
                                                       FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}"
                                                       VerticalAlignment="Center" />
                                            <StackPanel Spacing="1">
                                                <TextBlock Text="{Binding Name}" FontSize="{StaticResource FontSizeBody}"
                                                           TextTrimming="CharacterEllipsis" FontWeight="Medium" />
                                                <TextBlock Text="{Binding Category}" FontSize="{StaticResource FontSizeCaption}"
                                                           Foreground="{DynamicResource SystemControlForegroundAccentBrush}" />
                                            </StackPanel>
                                        </DockPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </DockPanel>
                </suki:GlassCard>

                <!-- Right: Apps -->
                <suki:GlassCard Grid.Column="2" Padding="12">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Recently Modified Apps"
                                   FontSize="{StaticResource FontSizeSubheading}" FontWeight="SemiBold" Margin="0,0,0,8" />
                        <ItemsControl ItemsSource="{Binding RecentlyModifiedApps}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:RecentItem">
                                    <Border Padding="8,5" Margin="0,0,0,2" CornerRadius="{StaticResource RadiusSmall}">
                                        <DockPanel>
                                            <TextBlock DockPanel.Dock="Right" Text="{Binding ModifiedText}"
                                                       FontSize="{StaticResource FontSizeCaption}" Foreground="{DynamicResource AppTextSecondaryBrush}"
                                                       VerticalAlignment="Center" />
                                            <StackPanel Spacing="1">
                                                <TextBlock Text="{Binding Name}" FontSize="{StaticResource FontSizeBody}"
                                                           TextTrimming="CharacterEllipsis" FontWeight="Medium" />
                                                <TextBlock Text="{Binding Category}" FontSize="{StaticResource FontSizeCaption}"
                                                           Foreground="{DynamicResource SystemControlForegroundAccentBrush}" />
                                            </StackPanel>
                                        </DockPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </DockPanel>
                </suki:GlassCard>
            </Grid>

        </StackPanel>
    </ScrollViewer>
    </Panel>
</UserControl>
